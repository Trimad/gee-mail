<html>

<head>
	<meta charset="utf-8">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet" media="screen">
	<script src="js/mail-generator.js"></script>
	<script src="js/sketch.js"></script>
	<script src="libraries/p5.min.js"></script>
	<script>

		window.onload = function () {
			// ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 

			var table = document.getElementById('table');
			let trashCount, inboxCount;
			let tc = document.getElementById('tc');
			let ic = document.getElementById('ic');
			for (i = 0; i < geemails.length; i++) {
				addRow(geemails[i]);
			}

			function addRow(g) {

				var row = table.insertRow(1);
				var mockSender = row.insertCell(0);
				var mockSubject = row.insertCell(1);
				var mockBody = row.insertCell(2);
				var mockDate = row.insertCell(3);

				mockSender.innerHTML = g.sender.substring(0, 128);
				mockSubject.innerHTML = g.subject.substring(0, 128);
				mockBody.innerHTML = g.body.substring(0, 256);
				mockDate.innerHTML = g.date.toISOString().split('T')[0];

				row.appendChild(mockSender);
				row.appendChild(mockSubject);
				row.appendChild(mockBody);
				row.appendChild(mockDate);

				trashCount = 0;
				inboxCount = geemails.length - trashCount;

				tc.innerHTML = `Trash(${trashCount})`
				ic.innerHTML = `Inbox(${inboxCount})`
			}

			setInterval(() => {
				let message = getNewMessage();
				window.geemails.push(message);
				addRow(message);
			}, 3000);

			/* Ripped straight from: 
			 * https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_sort_table
			 */
			sortTable = function (whichColumn) {

				let table, rows, switching, i, x, y, shouldSwitch;
				table = document.getElementById("table");
				switching = true;
				while (switching) {
					switching = false;
					rows = table.rows;
					for (i = 1; i < (rows.length - 1); i++) {
						shouldSwitch = false;
						x = rows[i].getElementsByTagName("TD")[whichColumn];
						y = rows[i + 1].getElementsByTagName("TD")[whichColumn];
						if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
							shouldSwitch = true;
							break;
						}
					}
					if (shouldSwitch) {
						rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
						switching = true;
					}
				}
			}
		};

	</script>

</head>

<!-- <body class="wrapper">

		<div class="header"></div>
		<div class="logo"></div>
		<div class="left"></div>
		<div class="right"></div>
		<div class="footer"></div>
	
	</body> -->

<body id="bg">

	<div id="top">
		<form action="/action_page.php">
			<input type="text" value="search"><br>
		</form>
	</div>
	<div id="bottom">

		<div id="left">
			<div class="clickable">
				<div id="ic" style="float:left">
				</div>
				<div style="float:right">
					<i class="material-icons">inbox</i>
				</div>
				<p></p>
			</div>
			<br>
			<div class="clickable">
				<div id="tc" style="float:left">
				</div>
				<div style="float:right">
					<i class="material-icons">delete</i>
				</div>
				<p></p>
			</div>
			<br>
			<div class="clickable">
				<div style="float:left">
					Settings
				</div>
				<div style="float:right">
					<i class="material-icons">settings</i>
				</div>
				<p></p>
			</div>

		</div>

		<div id="right">

			<table id="table">
				<tr>
					<th style="width:14%" onclick="sortTable(0)">
						<i class="material-icons">person</i>
						<!-- Sender -->
					</th>
					<th style="width:14%" onclick="sortTable(1)">
						<i class="material-icons">subject</i>
						<!-- Subject -->
					</th>
					<th style="width:61.8%" onclick="sortTable(2)">
						<i class="material-icons">format_align_justify</i>
						<!-- Body -->
					</th>
					<th style="width:10.2%" onclick="sortTable(3)">
						<i class="material-icons">calendar_today</i>
						<!-- Date -->
					</th>
				</tr>
			</table>

			<div>

				<h3>Created by: Tristan Madden 2018</h3>

			</div>
		</div>

	</div>


</body>

</html>